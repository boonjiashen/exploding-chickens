<!DOCTYPE html>

<html>
  <head>
    <title>
      Exploding chickens
    </title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  </head>
  <body>
    <canvas width="640" height="480"></canvas>
    <script>
      class Point {
        y;
        x;

        constructor(x, y) {
          this.x = x
          this.y = y
        }

        refresh(vel) {
          return new Point(this.x + vel.v_x, this.y + vel.v_y)
        }
      }

      class Velocity {
        v_x;
        v_y;

        constructor(v_x, v_y) {
          this.v_x = v_x
          this.v_y = v_y
        }
      }

      class Rect {
        x;
        y;
        width;
        height;

        constructor(x, y, width, height) {
          this.x = x
          this.y = y
          this.width = width
          this.height = height
        }

        getTopLeft() {
          return new Point(this.x, this.y)
        }

        isInside(rect) {
          return (this.x >= rect.x) && (this.y >= rect.y) && (this.x + this.width <= rect.x + rect.width) && (this.y + this.height <= rect.y + rect.height)
        }

        refresh(vel) {
          return new Rect(this.x + vel.v_x, this.y + vel.v_y, this.width, this.height)
        }
      }

      function getRectOfImage(img) {
        return new Rect(img.x, img.y, img.width, img.height)
      }

      function getRectOfCanvas(canvas) {
        return new Rect(0, 0, canvas.width, canvas.height)
      }

      const $c = $("canvas")
      const ctx = $c[0].getContext("2d")

      function clearCanvas(context) {
        context.clearRect(0, 0, context.canvas.width, context.canvas.height)
      }

      const img = new Image()
      img.src = "images/chicken.png"
      const w = ctx.canvas.width / 5
      const initRect = new Rect(0, 0, w, w)
      const init_vel = new Velocity(8, 0)
      var currRect = initRect
      var curr_vel = init_vel
      var isAnimationEnabled = true;

      function animate() {
        clearCanvas(ctx)
        ctx.drawImage(img, currRect.x, currRect.y, currRect.width, currRect.height)
        currRect = currRect.refresh(curr_vel)
        const isInCanvas = currRect.isInside(getRectOfCanvas(ctx.canvas))
        if (!isInCanvas) {
          curr_vel.v_x *= -1
        }
        if (isAnimationEnabled) {
          requestAnimationFrame(animate)
        }
        else {
          clearCanvas(ctx)
        }
      }

      img.onload = animate

      $c.click(function($event) {
        const canvasRect = this.getBoundingClientRect()
        const canvasClickPoint = new Point(
          $event.clientX - canvasRect.x,
          $event.clientY - canvasRect.y,
        )
        isAnimationEnabled = false
      })
    </script>
  </body>
</html>